<%= link_to "<< Back to Expenses", expenses_path, :class => "archived_link back_to_expenses" %>
<div class="payplan-section col-xs-6 pull-right">
  <br />
  <h2>Archived Payment Plans:</h2><br class="clr" />
  <table id="paymentplan" class="table table-bordered table-hover table-condensed">
    <% if current_plans.count > 0 %>
    <thead>
    <tr class="success">
      <th class="payment-header">Date</th>
      <% current_user.responsible_parties.all.each do |party| %>
        <th class="payment-header"><%= party.name%></th>
      <% end %>
      <th class="payment-header total">Total</th>
      <th class="payment-header">Action</th>
    </tr>
    </thead>
    <tbody>
    <% current_plans.each do |plan| %>
      <tr class="payment-row">
        <td class="payment-cell date"><%= plan.date%></td>
        <% current_user.responsible_parties.all.each do |party| %>
          <td class="payment-cell"><%= number_to_currency plan.get_payee_amt(party.name) %></td>
        <% end %>
        <td class="payment-cell total info"><b><%= number_to_currency plan.get_plan_total %></b></td>
        <td id="<%= plan.id %>" class="payment-cell action"><%= link_to "Edit", "#", :class => "btn btn-primary btn-xs", :data => {:toggle => "modal", :target => "#myModal#{plan.id}"} %>&nbsp;<%= link_to "Delete", payplan_path(plan), :class => "btn btn-danger btn-xs del_payment", :method => :delete, :data => {:confirm => "Deleting this plan will delete all payments included in the plan. Are you sure you want to delete this plan?"} %></td>
      </tr>

      <!-- Modal -->
      <div class="modal fade" id="myModal<%=plan.id%>" data-plan="<%= plan.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Modal title</h4>
            </div>
            <div class="modal-body">
              <%= render 'payplans/payplan_edit', :plan => plan %>
            </div>
            <div class="modal-footer">
              <button id="close-modal" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
              <button id="save-changes" type="button" class="btn btn-primary">Save changes</button>
            </div>
          </div>
        </div>
      </div>
    <% end %>  
    </tbody>
    <% else %>
      <h3>No Archived Payments</h3>
    <% end %>
  </table>

  <br class="clr" />
  <br />

</div>

<br />
<br />
<br />
<div class="col-xs-6 pull-left">
  <h2>Archived Expenses:</h2><br class="clr" />
  <% current_user.get_archived_expenses.each do |expense| %>
    <div class="col-xs-12 expense <%= "archived" if expense.archived %>">
    <!-- Main expense row -->

    <div class="col-xs-2 date-field">
      <%= expense.date.strftime("%b %d") %><br />
      <span class="retailer-field"><b><%= expense.retailer %></b></span>
    </div>
    <div class="col-xs-3 who-how-field">
      <span class="text-center">Who: <%= expense.responsible_party.name %></span><br />
      <span class="text-center">How: <%= expense.how_to_pay %></span>
    </div>
    <div class="col-xs-5 expense-field">
      <div class="card text-center"><%= expense.card.card_retailer %></div>
      <div class="text-center">
        <%= number_to_currency expense.amt_charged %> - &nbsp;
        <%= number_to_currency expense.amt_paid %> - &nbsp;
        <%= number_to_currency expense.amt_pending %> = &nbsp;
        <%= number_to_currency expense.amt_remaining %><br class="clr" />
      </div>
    </div>
  <% end %>
</div>